# 代码规范
## 凡是要在Release条件下编译的 VB/C# 代码必须遵循以下规范：
### 代码风格规则
- 所有没有提到的代码风格规范遵循最新版本 Visual Studio 默认设定
- 所有 公共的 命名空间，类，模块，方法，属性 名 一律采用 Pascal Case （禁止使用中文，日文等非ASCII字符命名）
- C# 代码的大括号 { 前需要换行

```C#
if(condition)
{
    // code
}
```

- VB 代码中打开 隐式转换和隐式类型之外的 Option Strict

```VB
#Enable Warning BC42017, BC42018, BC42019, BC42032, BC42036
```

- 不能使用语言特定类型名进行命名。类型名应该与CLR中的类型名对应。

```VB
Function ReadInteger() As Integer
Function ReadDate() As Date
' 应改为
Function ReadInt32() As Integer
Function ReadDateTime() As Date
```

```C#
int ReadInt();
float ReadFloat();
// 应改为
int ReadInt32();
float ReadSingle();
```

- 在被.NET Native 工具链生成本机代码的程序集 禁止在Linq中使用匿名类型查询

### CLS相关规则
https://msdn.microsoft.com/zh-cn/library/12a7a7h3(v=vs.110).aspx
- 尽量不要违背CLS。如果你的代码不可避免地违背CLS，需要提供符合CLS的变通。
- 任何公开非 CLSCompliant 类型的 类, 模块 或 成员 必须提供等价的 CLSCompliant 替换 

```VB
Public ReadOnly Property UnsafeNativeHandle As UIntPtr
' 等价替代：
Public ReadOnly Property UnsafeHandle As IntPtr
```

```C#
public unsafe void CopySpriteTable(Sprite* src, Sprite* dest, int count)
{
    
}
// 等价替代：
public void CopySpriteTable(Sprite[] src, Sprite[] dest, int count)
{
    
}
```

- 在禁止创建二义性的重载。下面是反例: 

```VB
Public Sub Initialize()

End Sub
Public Sub Initialize(param As Integer)

End Sub
' 不要在同一个类创建这样的方法
Public Sub Initialize(Optional param As Integer = 0)

End Sub
```

```C#
public void CopySpriteTable(Sprite[] src, Sprite[] dest, int count)
{

}
// 不要在同一个类创建这样的方法
public void CopySpriteTable(Sprite[] src, Sprite[] dest, ref int count)
{

}
```

- 避免大小写引起的二义性

```C#
public class Beetroot {}
// 需要将访问级别降低或重命名
public class BeetRoot {}
```

- 尽量避开用户可能使用的语言的保留关键字 (包括不常用的关键字), 即使在你用的语言里不是关键字。

```VB
' 需要重命名
Public Module unsafe
    ' 需要将访问级别降低
    Public Declare Function __makeref Lib "libmemhlp2333.dll" (__arglist As RuntimeArgumentHandle) As IntPtr

End Module
```

```C#
public class SpriteBitmap
{
    // 需要重命名
    public SpriteClip Get(Rect rect)
    {

    }
}
```

- 禁止定义语义上要求将事件作为参数传入的公共方法

```C#
public class Player
{
    // 需要重命名或降低访问级别
    public void Raise<TEventArgs>(EventHandler<TEventArgs> handler, TEventArgs e) where TEventArgs : EventArgs
    {
        if (handler != null)
        {
            handler(this, e);
        }
    }
}
```

## VB 代码风格建议
风格建议不遵循也不会影响 PR 的通过。但还是请大家尽量遵守。

注意: [C# 代码风格](https://github.com/dotnet/corefx/blob/master/Documentation/coding-guidelines/coding-style.md) 与 .NET Core 的保持一致，这里不再赘述。

1. 我们对于 `New With`, `New <TypeName>(<Args>) With` 和 `New From` 语句, 以及较长的集合 使用 K&R 风格的大括号。左括号位于一行的结尾，右括号占一行。
2. 我们使用以 4 为倍数的空格进行缩进。
3. 我们使用 `_camelCase` 对非 `Public` 字段命名。如果可以，添加 `ReadOnly` 修饰符。 实例字段以 `_` 开头, `Shared` 字段以 `s_` 开头, `<ThreadStatic> Shared` 字段以 `t_` 开头。如果使用 `Shared` 和 `ReadOnly`, `Shared` 在前, `ReadOnly` 在后。
4. 我们尽可能省略 `Me.` 。 
5. 我们总是显式指定访问级别 (即:
   `Private _foo As String` 而不是 `Dim _foo As String`)。可见性要在最前的位置 (即: 
   `Public MustOverride` 而不是 `MustOverride Public`)。
6. 代码文件中的命名空间和类型导入应该按字母排序。
7. 不要连续空两行。
8. 不要错误使用空白字符。例如 `If someVar = 0 Then...` 中, ... 的位置表示错误的空白字符。
   在 Visual Studio 中使用 "查看空白字符 (Ctrl+E, S)" 可以找出这种问题。
9. 代码中有与风格建议不同的地方 (例如私有成员命名为 `m_member`
   而不是 `_member`), 已经存在的风格优先。
10. 我们只在类型很明显的时候通过 `Option Infer` 和 `Dim` 推断变量类型。能使用变量类型推断的时候如果可以用 `As` 则使用 `As` 而不是 `=`。 (即: `Dim stream As New FileStream(...)` 而不是 `Dim stream = OpenStandardInput()` 或者 `Dim stream = New FileStream(...)`)。
11. 我们使用关键值而不是 BCL 类型 (i.e. `Integer, Date, Byte` 而不是 `Int32, DateTime, [Byte]` 这样的)。
12. 我们用大驼峰命名法命名常量。除非在编写互操作代码。
13. 我们在合适的情况下使用 `NameOf` 而不是字符串常量。
14. 字段应该被定义在类型的顶部。
15. 代码中含有非 ASCII 字符或字符串常量时，使用 UTF-8 编码保存这个代码文件 (尤其不要用 GB2312)。
